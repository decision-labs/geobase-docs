import { Callout } from 'nextra/components';
import YouTubeEmbed from '../../../components/youtube-embed';

# Importing OpenStreetMap (OSM) Data into Geobase

In this guide, we'll walk you through importing buildings data from OSM into your Geobase PostgreSQL database using `osm2pgsql`. The buildings will have heights and will be displayed as 3D buildings in Geobase.

<YouTubeEmbed
  videoId="KAODQW3mw0E"
  title="Importing OSM Data into Geobase"
/>

![3dbuildings](https://osm2pgsql.org/examples/3dbuildings/3dbuildings-manhatten.png)

By the end, you'll be able to:

1. Download OSM data from Protomaps.
2. Import the data into Geobase PostgreSQL.
3. Visualize the imported data using MapLibre through the Geobase Tile Server.

<Callout type="info" emoji="ℹ️">
  PostGIS is automatically enabled in your Geobase instance. But if you need to check it, you can do so in your Geobase dashboard by navigating to `Database` > `Extensions`.
</Callout>

## Prerequisites
1. **Geobase project is ready**: Ensure you have created a project on Geobase and have your database connection details from your Geobase project dashboard by navigating to `Project Settings` > `Connection Info`.
2. **`osm2pgsql` is installed**: `osm2pgsql`, a tool for importing OSM data into PostgreSQL/PostGIS databases. Installation instructions are available on the [osm2pgsql website](https://osm2pgsql.org/doc/install.html).


![osm2pgsql](https://d2w9rnfcy7mm78.cloudfront.net/31915594/original_33a7698a7032cd966bc0bfbd9591a877.png?1730644965?bc=0)


## Step 1: Download OSM Data from Protomaps

1. **Access Protomaps**: Visit [Protomaps OpenStreetMap Extracts](https://app.protomaps.com/).

![osm2pgsql](https://d2w9rnfcy7mm78.cloudfront.net/31915987/original_9f2e30fdbf3eafe989a50d1ee739d2f0.png?1730646913?bc=0)

2. **Select Area**: Use the **Draw Rectangle** or **Draw Polygon** tools to outline your area of interest on the map.
3. **Name Your Extract**: Provide a meaningful name for your extract (e.g., "NYC_3D_Buildings").
4. **Create Extract**: Click on **Create Extract**. Once processed, download the `.osm.pbf` file.

![osm2pgsql](https://d2w9rnfcy7mm78.cloudfront.net/31915991/original_9ee820d1a2d4beea7680914f86ae7391.png?1730646922?bc=0)



<div class="info">
  <strong>Note:</strong> The `.osm.pbf` format is a compressed binary format commonly used for OSM data.
</div>

## Step 2: Prepare Geobase Database Connection

Retrieve your Geobase database connection details:

1. **Navigate to Project Settings**: In your Geobase dashboard, go to `Project Settings > Connection Info`.
2. **Note the Details**: Record the following information:
   - **Host**
   - **Database Name**
   - **User**
   - **Password**
   - **Port**

![connection-details](https://d2w9rnfcy7mm78.cloudfront.net/31938652/original_7d4197b0ab174488678ae9d15787d61e.png?1730734188?bc=0)

These details will be used to connect `osm2pgsql` to your Geobase Postgres database.

## Step 3: Import OSM Data into Geobase

With your `.osm.pbf` file and database connection details ready, proceed to import the data:

1. **Download the Lua Configuration Script**: For 3D building data, download the `3dbuildings.lua` script from [3dbuildings.lua](https://osm2pgsql.org/examples/3dbuildings/3dbuildings.lua).

You can also use `curl` to download the script:

```sh
curl -O https://osm2pgsql.org/examples/3dbuildings/3dbuildings.lua
```

<Callout type="info" emoji="ℹ️">
`osm2pgsql` uses the lua script as a recipe to process the osm data and import it into the database that you provide it a connection to. In our example we are using the `3dbuildings.lua` script is for loading building footprints and their heights from osm into Geobase and displaying them as 3D buildings.
</Callout>

2. **Run `osm2pgsql` Command**: Open your terminal and execute the following command, replacing placeholders with your actual details: 

```sh
osm2pgsql -d postgres -U supabase_admin -H YOUR_PROJECT_REF.geobase.app \
  -P 6443 --password -O flex -S 3dbuildings.lua YOUR_OSM_FILE_PATH.osm.pbf
```

> you will need to replace `YOUR_PROJECT_REF` with your actual project reference and you will be prompted for the database password and `YOUR_OSM_FILE_PATH` with the path to your downloaded `.osm.pbf` file.

* `-d`: Database name.
* `-U`: Database user.
* `-H`: Database host.
* `-P`: Database port.
* `--password`: Prompts for the database password.
* `-O flex`: Uses the flexible output mode.
* `-S 3dbuildings.lua`: Specifies the Lua configuration script.
* `your_map.osm.pbf`: Path to your downloaded .osm.pbf file.

<Callout type="info" emoji="ℹ️">
  Ensure the `3dbuildings.lua` script is in your current directory or provide the full path to it.
</Callout>

## Step 4: Visualize Data in Geobase

After importing the data:

1. **Access TileServer**: In your Geobase dashboard, navigate to `TileServer`.

![osm2pgsql](https://d2w9rnfcy7mm78.cloudfront.net/31916503/original_20360973c7d8c6176dfb26e02ceb5e57.png?1730648956?bc=0)

2. **Enable Tables**: Click on **Tables** and check the box next to the imported table(s) to enable them.

3. **Integration Examples**: Go to **Integration Examples** and select **MapLibre**.

![osm2pgsql](https://d2w9rnfcy7mm78.cloudfront.net/31916502/original_64ebd87f4f519ba3e279d1e60ed6ecb4.png?1730648955?bc=0)

4. **View the Map**: Follow the provided instructions to visualize your data using MapLibre.

![osm2pgsql](https://d2w9rnfcy7mm78.cloudfront.net/31916505/original_15026a7eb3575c1856b70a7b0451a169.png?1730648958?bc=0)

<Callout type="info" emoji="ℹ️">
  For detailed styling and customization, refer to the [MapLibre documentation](https://maplibre.org/).
</Callout>

## Additional Resources

- **maplibre**: [MapLibre](https://maplibre.org/maplibre-gl-js/docs/) is an open-source, interoperable fork of Mapbox GL JS.
- **osm2pgsql Documentation**: Comprehensive guides and examples are available on the [osm2pgsql website](https://osm2pgsql.org/doc/manual.html).
- **Protomaps Documentation**: Learn more about data extraction and usage at [Protomaps Docs](https://docs.protomaps.com/).

## Support
If you encounter any issues or have further questions, reach out on [Discord](https://geobase.app/discord).

